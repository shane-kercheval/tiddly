@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* Full viewport height for app layout */
html, body, #root {
  height: 100%;
}

/* Prevent horizontal scroll on mobile */
html, body {
  overflow-x: hidden;
  max-width: 100vw;
}

/* Safe area support for notched devices (iPhone X+, etc.) */
body {
  padding-bottom: env(safe-area-inset-bottom);
}

@layer components {
  /* Button variants - compact sizing */
  .btn-primary {
    @apply rounded-md bg-gray-900 px-3 py-1.5 text-sm font-medium text-white transition-all hover:bg-gray-800 disabled:cursor-not-allowed disabled:bg-gray-300 disabled:hover:bg-gray-300;
  }

  .btn-secondary {
    @apply rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 hover:border-gray-300 disabled:cursor-not-allowed disabled:opacity-50;
  }

  .btn-danger {
    @apply rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white transition-all hover:bg-red-700 disabled:cursor-not-allowed disabled:bg-red-300 disabled:hover:bg-red-300;
  }

  .btn-ghost {
    @apply rounded-md bg-transparent px-3 py-1.5 text-sm font-medium text-gray-600 transition-all hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Icon buttons with touch-friendly sizing on mobile (44px min target) */
  .btn-icon {
    @apply rounded-lg p-2 text-gray-400 transition-all hover:bg-gray-100 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-50;
  }

  .btn-icon-danger {
    @apply rounded-lg p-2 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500 disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Smaller icon buttons on desktop where precision pointing is easier */
  @media (min-width: 768px) {
    .btn-icon {
      @apply p-1;
    }
    .btn-icon-danger {
      @apply p-1;
    }
  }

  /* Form inputs */
  .input {
    @apply w-full rounded-lg border border-gray-200 bg-gray-50/50 px-3 py-2 text-sm transition-all placeholder:text-gray-400 focus:border-gray-300 focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/5 disabled:bg-gray-100 disabled:text-gray-500;
  }

  /* Select dropdowns - Safari-compatible with custom arrow */
  .select {
    @apply w-full rounded-lg border border-gray-200 bg-gray-50/50 px-3 py-2 pr-8 text-sm transition-all focus:border-gray-300 focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/5 disabled:bg-gray-100 disabled:text-gray-500 appearance-none cursor-pointer bg-no-repeat;
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
    background-size: 1.25rem 1.25rem;
    background-position: right 0.5rem center;
  }

  .input-error {
    @apply border-red-200 bg-red-50/50 focus:border-red-300 focus:ring-red-500/10;
  }

  /* Loading spinner */
  .spinner {
    @apply animate-spin rounded-full border-2 border-gray-200 border-t-gray-900;
  }

  .spinner-xs {
    @apply h-3.5 w-3.5 animate-spin rounded-full border-gray-200 border-t-gray-900;
    border-width: 1.5px;
  }

  .spinner-sm {
    @apply h-4 w-4 animate-spin rounded-full border-2 border-gray-200 border-t-gray-900;
  }

  .spinner-md {
    @apply h-8 w-8 animate-spin rounded-full border-2 border-gray-200 border-t-gray-900;
  }

  .spinner-lg {
    @apply h-12 w-12 animate-spin rounded-full border-2 border-gray-200 border-t-gray-900;
  }

  /* Badge/Tag styles */
  .badge {
    @apply inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium;
  }

  .badge-primary {
    @apply inline-flex items-center rounded-md bg-blue-50 px-2 py-0.5 text-xs font-medium text-blue-600 border border-blue-100;
  }

  .badge-secondary {
    @apply inline-flex items-center rounded-md bg-gray-50 px-2 py-0.5 text-xs font-normal text-gray-600 border border-gray-200;
  }

  /* Modal backdrop with safe area support for notched devices */
  .modal-backdrop {
    @apply fixed inset-0 z-50 flex items-center justify-center bg-gray-900/20 backdrop-blur-sm p-4;
    padding-top: max(1rem, env(safe-area-inset-top));
    padding-right: max(1rem, env(safe-area-inset-right));
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
    padding-left: max(1rem, env(safe-area-inset-left));
  }

  .modal-content {
    @apply relative max-h-[90vh] w-full overflow-y-auto rounded-2xl bg-white shadow-2xl border border-gray-100;
  }

  /* Consistent hover background for list items */
  .list-item-hover {
    @apply transition-colors hover:bg-gray-100;
  }

  /* Card styles - Apple Messages inspired list item */
  /* Mobile: no negative margins to prevent horizontal overflow */
  /* Desktop: negative margins for edge-to-edge hover effect */
  .card {
    @apply py-3 px-3 rounded-xl transition-all relative;
  }

  @media (min-width: 768px) {
    .card {
      @apply -mx-3;
    }
  }

  /* Interactive card with hover effect (for list items) */
  .card-interactive {
    @apply hover:bg-gray-100;
  }

  .card::after {
    content: '';
    @apply absolute bottom-0 h-px bg-gray-200;
    left: 1rem;
    right: 1rem;
  }

  .card:last-child::after {
    @apply hidden;
  }

  /* Alert/Notice styles */
  .alert-warning {
    @apply rounded-lg bg-amber-50 border border-amber-100 p-3 text-amber-700;
  }

  .alert-error {
    @apply rounded-lg bg-red-50 border border-red-100 p-3 text-red-600;
  }

  .alert-success {
    @apply rounded-lg bg-emerald-50 border border-emerald-100 p-3 text-emerald-600;
  }

  .alert-info {
    @apply rounded-lg bg-blue-50 border border-blue-100 p-3 text-blue-600;
  }

  /* Form label */
  .label {
    @apply block text-sm font-medium text-gray-600;
  }

  /* Helper text */
  .helper-text {
    @apply mt-1.5 text-xs text-gray-400;
  }

  .error-text {
    @apply mt-1.5 text-sm text-red-500;
  }
}

/* Milkdown Editor Styles */
.milkdown-wrapper {
  @apply bg-white;
}

/* Main editor container */
.milkdown-wrapper .milkdown {
  @apply min-h-[200px];
}

/* The actual editable area */
.milkdown-wrapper .milkdown .editor {
  @apply p-4 outline-none text-gray-900 text-sm leading-relaxed relative;
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Minimal padding variant - matches title/description px-1 (4px) for alignment */
.milkdown-wrapper.no-padding .milkdown .editor {
  @apply p-1;
}

/* CodeMirror minimal padding variant */
.codemirror-no-padding .cm-editor .cm-scroller {
  padding-top: 0.25rem;
}
.codemirror-no-padding .cm-editor .cm-content {
  padding-left: 0.25rem; /* px-1 = 4px to match title/description */
}

/* Paragraph spacing */
.milkdown-wrapper .milkdown p {
  @apply my-3 first:mt-0 last:mb-0;
}

/* Headings */
.milkdown-wrapper .milkdown h1 {
  @apply text-2xl font-bold text-gray-900 mt-6 mb-4 first:mt-0;
}

.milkdown-wrapper .milkdown h2 {
  @apply text-xl font-semibold text-gray-900 mt-5 mb-3 first:mt-0;
}

.milkdown-wrapper .milkdown h3 {
  @apply text-lg font-semibold text-gray-900 mt-4 mb-2 first:mt-0;
}

.milkdown-wrapper .milkdown h4,
.milkdown-wrapper .milkdown h5,
.milkdown-wrapper .milkdown h6 {
  @apply text-base font-semibold text-gray-900 mt-4 mb-2 first:mt-0;
}

/* Bold and italic */
.milkdown-wrapper .milkdown strong {
  @apply font-semibold text-gray-900;
}

.milkdown-wrapper .milkdown em {
  @apply italic;
}

/* Strikethrough */
.milkdown-wrapper .milkdown del,
.milkdown-wrapper .milkdown s {
  @apply line-through text-gray-500;
}

/* Links */
.milkdown-wrapper .milkdown a {
  @apply text-blue-600 underline hover:text-blue-800;
}

/* Inline code */
.milkdown-wrapper .milkdown code {
  @apply bg-gray-100 px-1.5 py-0.5 rounded text-sm text-pink-600 font-mono;
}

/* Code blocks */
.milkdown-wrapper .milkdown pre {
  @apply bg-gray-900 text-gray-100 rounded-lg p-4 overflow-auto my-4 text-sm;
}

.milkdown-wrapper .milkdown pre code {
  @apply bg-transparent text-gray-100 p-0 text-sm font-mono;
}

/* Blockquotes */
.milkdown-wrapper .milkdown blockquote {
  @apply border-l-4 border-gray-300 pl-4 my-4 text-gray-600 italic;
}

/* Unordered lists */
.milkdown-wrapper .milkdown ul {
  @apply list-disc pl-6 my-3 space-y-0.5;
}

/* Ordered lists */
.milkdown-wrapper .milkdown ol {
  @apply list-decimal pl-6 my-3 space-y-0.5;
}

/* List items */
.milkdown-wrapper .milkdown li {
  @apply text-gray-700;
}

.milkdown-wrapper .milkdown li p {
  @apply my-0;
}

/* Nested lists */
.milkdown-wrapper .milkdown ul ul,
.milkdown-wrapper .milkdown ol ol,
.milkdown-wrapper .milkdown ul ol,
.milkdown-wrapper .milkdown ol ul {
  @apply my-1;
}

/* Task lists (checkboxes) - Milkdown uses data attributes instead of input elements
 * IMPORTANT: The checkbox click detection in MilkdownEditor.tsx (CHECKBOX_CLICK_AREA_WIDTH)
 * depends on these dimensions. The checkbox is 16px (h-4 w-4) + 8px gap = ~24px total.
 * If you change these styles, update CHECKBOX_CLICK_AREA_WIDTH in MilkdownEditor.tsx accordingly.
 */
.milkdown-wrapper .milkdown li[data-item-type="task"] {
  @apply list-none flex flex-wrap items-start gap-x-2;
}

/* Paragraph content inside task items should stay inline with checkbox */
.milkdown-wrapper .milkdown li[data-item-type="task"] > p {
  @apply flex-1 min-w-0;
}

/* Nested lists inside task items should take full width to appear below */
.milkdown-wrapper .milkdown li[data-item-type="task"] > ul,
.milkdown-wrapper .milkdown li[data-item-type="task"] > ol {
  @apply w-full my-0;
  margin-left: 1.5rem; /* Indent nested lists */
}

/* Remove margin from all nested lists within task items to prevent extra gaps */
.milkdown-wrapper .milkdown li[data-item-type="task"] ul,
.milkdown-wrapper .milkdown li[data-item-type="task"] ol {
  @apply my-0;
}

.milkdown-wrapper .milkdown li[data-item-type="task"]::before {
  content: '';
  @apply mt-1 h-4 w-4 rounded border border-gray-300 bg-white flex-shrink-0 cursor-pointer;
  display: inline-block;
  min-width: 1rem;
  min-height: 1rem;
}

.milkdown-wrapper .milkdown li[data-item-type="task"][data-checked="true"]::before {
  @apply bg-blue-600 border-blue-600;
  background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
  background-size: 100% 100%;
  background-position: center;
  background-repeat: no-repeat;
}

/* Remove default bullet from task list parent */
.milkdown-wrapper .milkdown ul:has(li[data-item-type="task"]) {
  @apply list-none pl-4;
}

/* Horizontal rule */
.milkdown-wrapper .milkdown hr {
  @apply my-6 border-t border-gray-300;
}

/* Tables */
.milkdown-wrapper .milkdown table {
  @apply w-full border-collapse my-4 text-sm;
}

.milkdown-wrapper .milkdown th {
  @apply border border-gray-300 px-3 py-2 bg-gray-50 font-semibold text-left text-gray-700;
}

.milkdown-wrapper .milkdown td {
  @apply border border-gray-300 px-3 py-2 text-left text-gray-700;
}

/* Images */
.milkdown-wrapper .milkdown img {
  @apply max-w-full h-auto rounded-lg my-4;
}

/* Selection styling */
.milkdown-wrapper .milkdown ::selection {
  @apply bg-blue-100;
}

/* Placeholder when empty - uses ::before pseudo-element to avoid focus issues */
.milkdown-wrapper .milkdown p.is-empty::before {
  content: attr(data-placeholder);
  @apply text-gray-400 italic pointer-events-none float-left h-0;
}

/* Focus state for editor */
.milkdown-wrapper .milkdown .ProseMirror:focus {
  @apply outline-none;
}
